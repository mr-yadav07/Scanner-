<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Face Detection Alarm</title>
<style>
  body,html {
    margin:0; padding:0; height:100%; display:flex; flex-direction:column;
    align-items:center; justify-content:center; font-family: Arial,sans-serif;
    background:#000; color:#0f0;
  }
  video, canvas {
    max-width: 100vw;
    border-radius: 8px;
    border: 3px solid #0f0;
    background:#000;
  }
  video {
    max-height: 70vh;
  }
</style>
</head>
<body>
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas" style="display:none;"></canvas>
  <audio id="alarm" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>
<script type="module">
import * as faceapi from 'https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/+esm';
(async function(){
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const alarm = document.getElementById('alarm');
  try {
    const stream = await navigator.mediaDevices.getUserMedia({video: {facingMode: 'user'}});
    video.srcObject = stream;
  } catch(e) {
    alert('Camera access denied or not available.');
    return;
  }
  await faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/weights');
  const options = new faceapi.TinyFaceDetectorOptions();
  let alarmPlaying = false;
  function detect(){
    faceapi.detectAllFaces(video, options).then(detections=>{
      if(detections.length>0){
        if(!alarmPlaying){
          alarm.play();
          alarmPlaying = true;
        }
      } else {
        alarm.pause();
        alarm.currentTime = 0;
        alarmPlaying = false;
      }
      requestAnimationFrame(detect);
    });
  }
  detect();
})();
</script>
</body>
</html>
